[TOC]



# TCPλ¥Ό μ΄μ©ν• ν†µμ‹  κ³Όμ •

## :star: μ—°κ²° μλ¦½ κ³Όμ •

> TCPλ¥Ό μ΄μ©ν• λ°μ΄ν„° ν†µμ‹ μ„ ν•  λ• ν”„λ΅μ„Έμ¤μ™€ ν”„λ΅μ„Έμ¤λ¥Ό μ—°κ²°ν•κΈ° μ„ν•΄ **κ°€μ¥ λ¨Όμ € μν–‰λλ” κ³Όμ •**
>
> μ΄ κ³Όμ •μ„ κ±°μ³μ•Όλ§ λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›μ„ μ μλ‹¤.

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ”μ²­ ν¨ν‚·μ„ λ³΄λ‚΄κ³  (μ—°κ²°ν•΄λ„ λλ‚μ”? & μ„λ²„κ°€ λ¨Όμ € λ³΄λ‚Ό μΌμ€ μ—†λ‹¤. λ„¤μ΄λ²„κ°€ κ°‘μκΈ° λ‚΄ μ»΄ν“¨ν„°μ— λ°μ΄ν„°λ¥Ό λ³΄λ‚Έλ‹¤? μμ„ μ μ—†μ£ )
2. μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ λ°›μ•„λ“¤μ΄λ” ν¨ν‚·μ„ λ³΄λ‚΄κ³  (μ‘ ν•΄λ„ λλ‹¤ + μ„λ²„λ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ—°κ²° μ”μ²­μ„ λ³΄λ‚Έλ‹¤.)
3. ν΄λΌμ΄μ–ΈνΈλ” μ΄λ¥Ό μµμΆ…μ μΌλ΅ μλ½ν•λ” ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤. (λ‹Ήμ—°ν•μ§€)

**=> μ„μ 3κ°μ κ³Όμ •μ„ 3Way HandshakeλΌκ³  λ¶€λ¥Έλ‹¤.**



1. νμ΄λ΅λ“ μ—†μ΄ ν¨ν‚·λ§ μ°μ„  ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„λ΅ λ³΄λ‚Έλ‹¤.

![tcp_3way_handshake_01](network/tcp_3way_handshake_01.PNG)

![tcp_3way_handshake_02](network/tcp_3way_handshake_02.PNG)

β€‹	TCP ν”„λ΅ν† μ½μ λ¨μµ. λ„μ°©μ§€ ν¬νΈλ” 80μ΄κ³ , ν”λκ·Έκ°€ **λ™κΈ°ν™”(sync) ν”λκ·Έ**μ΄λ©° SEQ λ²νΈμ™€ ACK λ²νΈκ°€ λλ¤μΌλ΅ μ„¤μ •λλ‹¤.

<br>

2. μ„λ²„μ—μ„ λ°›μ€ μ”μ²­μ„ ν•΄μ„ν•λ‹¤. μ΄λ• SEQλ²νΈλ” λλ¤μΌλ΅ μ •ν•΄μ§„λ‹¤.

![tcp_3way_handshake_03](network/tcp_3way_handshake_03.PNG)

β€‹	μ°Έκ³ λ΅ ACK λ²νΈλ” λΉ„μ–΄μλ‹¤λ” λ»μ—μ„ 0μ΄λ‹¤.

<br>

3. μ„λ²„μ—μ„ λ°›μ€ μ”μ²­μ„ ν•΄μ„ν•λ‹¤. μ΄ν›„ λ‹¤μ‹ ν¨ν‚·μ„ λ§λ“¤μ–΄ μ „λ‹¬ν•λ‹¤. μ„λ²„λ„ μΉμΈκ³Ό μ”μ²­μ„ ν•΄μ•Όν•λ―€λ΅ SYNμ™€ ACK ν”λκ·Έκ°€ λ‹΄κΈ΄ TCP ν”„λ΅ν† μ½μ„ λ§λ“ λ‹¤.

![tcp_3way_handshake_04](network/tcp_3way_handshake_04.PNG)

![tcp_3way_handshake_05](network/tcp_3way_handshake_05.PNG)

<br>

4. ν΄λΌμ΄μ–ΈνΈλ” λ°›μ€ ν¨ν‚·μ„ ν•΄μ„ν•λ‹¤. μ΄ν›„ ACK(μ‘λ‹µ) ν”λκ·Έλ¥Ό λ‹΄μ•„ λ§μ§€λ§‰ 3λ‹¨κ³„λ΅ μ‘λ‹µμ„ λ³΄λ‚Έλ‹¤.

![tcp_3way_handshake_06](network/tcp_3way_handshake_06.PNG)

<br>

5. μ΄ μ‘λ‹µμ„ μ„λ²„κ°€ λ°›μΌλ©΄ μ—°κ²°μ„ μλ¦½ν•λ” κ³Όμ •μ΄ λ§λ¬΄λ¦¬ λλ‹¤.

![tcp_3way_handshake_07](network/tcp_3way_handshake_07.PNG)

β€‹	μ΄μ  λ‹¤μμΌλ΅ μ”μ²­μ„ λ³΄λ‚΄λ” κ³³μ€ μ–΄λ””μΌκΉ? ν΄λΌμ΄μ–ΈνΈ? μ„λ²„?

![tcp_3way_handshake_08](network/tcp_3way_handshake_08.PNG)

μ •λ‹µμ€ ν΄λΌμ΄μ–ΈνΈμ΄λ‹¤! μ΄ κ³Όμ •μ€ μ—°κ²°μ„ μλ¦½ν•λ” κ³Όμ •μ΄κ³ , μ—°κ²°μ΄ λκ³  λ‚μ„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ›ν•λ” λ°μ΄ν„°λ¥Ό λ³΄λ‚΄λ‹¬λΌκ³  μ”μ²­ν•΄μ•Όν•λ‹¤. 

μ—°κ²°ν•κ³ λ‚μ„ κ°€λ§ν μμΌλ©΄ μ„λ²„λ” λ­. μ–΄μ©”??

<br>

> μ„Έμ… ν•μ΄μ¬ν‚Ή

κ·Έλ°λ°, ν΄λΌμ΄μ–ΈνΈκ°€ μ•„λ‹ λ„κµ°κ°€κ°€ μ΄ κ°’(SEQ, ACK λ²νΈ)μ„ κ³„μ‚°ν•΄μ„ μ”μ²­μ„ λ³΄λ‚΄λ©΄ μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ•„λ‹ λ‹¤λ¥Έ λ„κµ°κ°€μ™€ ν†µμ‹ ν•κ² λλ‹¤. 

ν΄λΌμ΄μ–ΈνΈλ” λ‚™λ™κ°• μ¤λ¦¬μ•μ΄ λλ‹¤. μ—°κ²° μλ¦½ λ‹¤ν•΄λ†¨λ”λ‹ κ°‘μκΈ° μ„λ²„κ°€ λ‹¤λ¥Έ μ• λ‘ μ–κΈ°ν•λ‹¤.

λ„¤μ΄λ²„μ— λ΅κ·ΈμΈ ν•΄λ†¨λ”λ° μ΄ μƒνƒλ΅ μΈν„°λ„· ν•κ³  μλ‹¤κ°€ μ—°κ²°μ„ λ„κ°€ λΉΌμ•—μΌλ©΄? κ·Έ ν•΄μ»¤λ” λ‚΄ μ•„μ΄λ””λ‘ λΉ„λ²μ„ λ°λΌλ„ λ‚΄κ°€ λ΅κ·ΈμΈν• μƒνƒλ΅ λ¨λ“  μ„λΉ„μ¤λ¥Ό μ‚¬μ©ν•  μ μλ” κ²ƒμ΄λ‹¤. 

<br>

## π’Ύ λ°μ΄ν„° ν†µμ‹  κ³Όμ •

> μ—°κ²°μ΄ μλ¦½λκ³ λ‚ μ΄ν›„, λ°μ΄ν„°λ¥Ό μ£Όκ³  λ°›λ” κ³Όμ •.
>
> TCPλ¥Ό μ΄μ©ν•΄μ„ λ°μ΄ν„° ν†µμ‹ μ„ ν•  λ• λ‹¨μν TCP ν¨ν‚·λ§ μΊ΅μν™”ν•΄μ„ ν†µμ‹ ν•λ” κ²ƒμ΄ μ•„λ‹, νμ΄λ΅λ“λ¥Ό ν¬ν•¨ν• ν¨ν‚·μ„ μ£Όκ³  λ°›μ„ λ•μ μΌμ •ν• κ·μΉ™

1. ν΄λΌμ΄μ–ΈνΈλ” μ—°κ²°λ• μ‚¬μ©ν• λ§μ§€λ§‰ SEQ, ACK λ²νΈλ¥Ό κ·Έλ€λ΅ μ΄μ–΄κ°„λ‹¤. λ³΄λ‚Έ μ½μ—μ„ λ λ³΄λ‚Ό λ•λ” SEQ, ACK λ²νΈκ°€ κ·Έλ€λ΅λ‹¤.
2. μ„λ²„μ—μ„ λ°›μ•μ„ λ• ACK λ²νΈ κ·Έλ€λ΅ SEQ λ²νΈκ°€ λλ‹¤.
3. λ°›λ” μ½μ—μ„ ACKλ²νΈλ” SEQλ²νΈ + λ°μ΄ν„° ν¬κΈ°
   - μ΄μ   λ°μ΄ν„°(payload)λ¥Ό μ£Όκ³ λ°›κ³  μμΌλ‹, μ΄ λ°μ΄ν„°μ ν¬κΈ°λ΅ μΈν•΄ λ²νΈκ°€ λ°”λ€κ² λλ‹¤.

<br>

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² μ”μ²­μ— κ΄€ν• Dataκ°€ λ‹΄κΈ΄ ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.

![tcp_3way_handshake_09](network/tcp_3way_handshake_09.PNG)

![tcp_3way_handshake_10](network/tcp_3way_handshake_10.PNG)

β€‹	SEQ, ACK λ²νΈλ¥Ό λ³΄λ©΄ μ•„κΉ μ‚¬μ©ν• λ²νΈλ¥Ό κ³„μ† μ΄μ©ν•κ³  μλ‹¤.



2. μ„λ²„κ°€ μ”μ²­μ„ λ°›κ³  μ›ν•λ” λ°μ΄ν„°λ¥Ό λ‹΄μ•„ ν¨ν‚·μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤.

![tcp_3way_handshake_11](network/tcp_3way_handshake_11.PNG)

<br>

3. ν΄λΌμ΄μ–ΈνΈλ” λ°μ΄ν„°λ¥Ό μ λ°›μ•λ‹¤κ³  μ„λ²„μ—κ² μ‘λ‹µμ„ λ³΄λ‚Έλ‹¤.

![tcp_3way_handshake_12](network/tcp_3way_handshake_12.PNG)



### TCP μ—°κ²° μƒνƒ

> ν¨ν‚·μ„ μ£Όκ³  λ°›μ„λ• SEQ, ACK λ²νΈ λ§κ³ λ„ **TCPμ μ—°κ²° μƒνƒ**λ„ λ³€ν•λ‹¤.

![tcp_3way_handshake_13](network/tcp_3way_handshake_13.PNG)



<br>

### 4 way handshake (μ—°κ²° ν•΄μ )

![tcp_3way_handshake_14](network/tcp_3way_handshake_14.PNG)

μ—°κ²° μ„±λ¦½ μ΄ν›„, λ¨λ“  ν†µμ‹ μ΄ λλ‚¬λ‹¤λ©΄ μ—°κ²°μ„ ν•΄μ ν•΄μ•Ό ν•λ‹¤.

1. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—κ² μ—°κ²°μ„ μΆ…λ£ν•λ‹¤λ” `FIN` ν”λκ·Έλ¥Ό λ³΄λ‚Έλ‹¤.
2. μ„λ²„λ” `FIN` μ„ λ°›κ³ , ν™•μΈν–λ‹¤λ” `ACK`λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤. (μ΄λ• λ¨λ“  λ°μ΄ν„°λ¥Ό λ³΄λ‚΄κΈ° μ„ν•΄ CLOSE_WAIT μƒνƒκ°€ λλ‹¤.)
3. λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³΄λƒλ‹¤λ©΄, μ—°κ²°μ΄ μΆ…λ£λμ—λ‹¤λ” `FIN` ν”λκ·Έλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤.
4. ν΄λΌμ΄μ–ΈνΈλ” `FIN` μ„ λ°›κ³ , ν™•μΈν–λ‹¤λ” `ACK`λ¥Ό μ„λ²„μ—κ² λ³΄λ‚Έλ‹¤.
   - ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ `ACK`κ°€ λ„¤νΈμ›ν¬ μ¤λ¥ λ“±μΌλ΅ λ„μ°©ν•μ§€ μ•μ•μ„ κ²½μ°λ¥Ό κ³ λ ¤ν•μ—¬ TIME_WAITμΌλ΅ κΈ°λ‹¤λ¦°λ‹¤.

- μ„λ²„λ” `ACK`λ¥Ό λ°›μ€ μ΄ν›„ μ†μΌ“μ„ λ‹«λ”λ‹¤. TIME_WAIT μ‹κ°„μ΄ λλ‚λ©΄ ν΄λΌμ΄μ–ΈνΈλ„ λ‹«λ”λ‹¤.